{
  "createdAt": "2025-08-28T21:38:35.355Z",
  "updatedAt": "2025-09-10T22:38:57.000Z",
  "id": "LiVE3BlxsFkHhG83",
  "name": "UYSP-Calendly-Booked",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "calendly",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "wb",
      "name": "Webhook (Calendly)",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -800,
        -80
      ],
      "webhookId": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const raw = $json || {};\nconst body = raw.body || raw;\nconst payload = body.payload || body || {};\n\nconst email = (payload?.invitee?.email || payload?.email || '').toString().trim().toLowerCase();\n\nlet phoneRaw = '';\nif (payload?.invitee?.phone_number) {\n  phoneRaw = String(payload.invitee.phone_number);\n} else if (Array.isArray(payload?.questions_and_answers)) {\n  const qa = payload.questions_and_answers.find(q =>\n    String(q?.question || '').toLowerCase().includes('phone')\n  );\n  phoneRaw = qa?.answer ? String(qa.answer) : '';\n}\nconst phoneDigits = phoneRaw.replace(/\\D/g, '').replace(/^1(?=\\d{10}$)/, '');\n\nconst eventId = (payload?.event_uuid || payload?.event || payload?.event_id || '').toString();\nconst bookedAt = payload?.start_time || payload?.time || new Date().toISOString();\n\nif (!email && !phoneDigits) return null;\nreturn { json: { email, phoneDigits, eventId, bookedAt } };"
      },
      "id": "parse",
      "name": "Parse Calendly",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -576,
        -80
      ]
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "app4wIsBfpJTg7pWS",
          "mode": "id"
        },
        "table": {
          "mode": "list",
          "value": "tblYUvhGADerbD8EO"
        },
        "filterByFormula": "=={{`OR(\n  LOWER({Email})='${($json.email||'').toLowerCase()}',\n  REGEX_REPLACE({Phone}, '\\\\\\\\D', '')='${$json.phoneDigits||''}'\n)`}}",
        "returnAll": false,
        "options": {}
      },
      "id": "find",
      "name": "Find Lead by Email",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2,
      "position": [
        -352,
        -80
      ],
      "credentials": {
        "airtableTokenApi": {
          "id": "Zir5IhIPeSQs72LR",
          "name": "Airtable UYSP Option C"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "base": {
          "__rl": true,
          "value": "app4wIsBfpJTg7pWS",
          "mode": "id"
        },
        "table": {
          "mode": "list",
          "value": "tblYUvhGADerbD8EO"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.id }}",
            "Booked": true,
            "Booked At": "={{ $('Parse Calendly').item.json.bookedAt }}",
            "SMS Stop": true,
            "SMS Stop Reason": "BOOKED",
            "Processing Status": "Completed"
          },
          "matchingColumns": [
            "id"
          ]
        },
        "options": {
          "typecast": true
        }
      },
      "id": "update",
      "name": "Mark Booked",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2,
      "position": [
        -128,
        -80
      ],
      "credentials": {
        "airtableTokenApi": {
          "id": "Zir5IhIPeSQs72LR",
          "name": "Airtable UYSP Option C"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "return { json: { ok: true } }"
      },
      "id": "resp",
      "name": "Respond 200",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        320,
        -80
      ]
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C09D6U5BLG6",
          "mode": "list",
          "cachedResultName": "uysp-sales-daily"
        },
        "text": "=CALENDLY BOOKED: {{$items('Parse Calendly',0)[$itemIndex].json.email}} / {{$items('Parse Calendly',0)[$itemIndex].json.phoneDigits}}\\nAt: {{$items('Parse Calendly',0)[$itemIndex].json.bookedAt}}",
        "otherOptions": {}
      },
      "id": "slackBooked",
      "name": "Booked Notify",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        96,
        -80
      ],
      "webhookId": "2a354fd6-637a-4b5e-b3b2-2a532bc628b6",
      "credentials": {
        "slackOAuth2Api": {
          "id": "OyxQzoqNPQocHdnn",
          "name": "Slack account"
        }
      }
    }
  ],
  "connections": {
    "Webhook (Calendly)": {
      "main": [
        [
          {
            "node": "Parse Calendly",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Calendly": {
      "main": [
        [
          {
            "node": "Find Lead by Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Find Lead by Email": {
      "main": [
        [
          {
            "node": "Mark Booked",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark Booked": {
      "main": [
        [
          {
            "node": "Booked Notify",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Booked Notify": {
      "main": [
        [
          {
            "node": "Respond 200",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "saveManualExecutions": true,
    "saveExecutionProgress": true
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "3d100352-f7c1-45c2-b953-602a18d92988",
  "triggerCount": 1,
  "shared": [
    {
      "createdAt": "2025-08-28T21:42:12.198Z",
      "updatedAt": "2025-08-28T21:42:12.198Z",
      "role": "workflow:owner",
      "workflowId": "LiVE3BlxsFkHhG83",
      "projectId": "H4VRaaZhd8VKQANf",
      "project": {
        "createdAt": "2025-07-20T10:20:07.367Z",
        "updatedAt": "2025-07-20T10:23:14.000Z",
        "id": "H4VRaaZhd8VKQANf",
        "name": "UYSP Lead Qualification Agent ",
        "type": "team",
        "icon": {
          "type": "icon",
          "value": "layer-group"
        },
        "description": "Automated lead qualification and SMS outreach system that processes Kajabi form submissions, enriches B2B leads through two-phase qualification, scores them 0-100 using AI, and sends personalized SMS to qualified prospects while maintaining strict compliance and cost controls.",
        "projectRelations": [
          {
            "createdAt": "2025-07-20T10:23:14.911Z",
            "updatedAt": "2025-07-20T10:23:14.911Z",
            "role": "project:admin",
            "userId": "29d0ac76-1b0e-4f0b-a9dd-b710d2476efa",
            "projectId": "H4VRaaZhd8VKQANf",
            "user": {
              "createdAt": "2025-07-01T09:55:15.012Z",
              "updatedAt": "2025-09-10T22:00:48.000Z",
              "id": "29d0ac76-1b0e-4f0b-a9dd-b710d2476efa",
              "email": "latifhorst@gmail.com",
              "firstName": "LATIF",
              "lastName": "HORST",
              "personalizationAnswers": null,
              "settings": {
                "userActivated": true,
                "easyAIWorkflowOnboarded": true,
                "firstSuccessfulWorkflowId": "Zdpywk5ic1hYILgr",
                "userActivatedAt": 1751967003557,
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1753035927344
                }
              },
              "role": "global:owner",
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2025-09-10",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": []
}
