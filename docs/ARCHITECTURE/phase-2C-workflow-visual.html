<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Phase 2C Workflow Visual — Hunter Waterfall</title>
  <style>
    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji"; margin: 0; color: #0f172a; background: #fafafa; }
    header { padding: 18px 24px; background: #111827; color: #fff; }
    header h1 { margin: 0; font-size: 18px; font-weight: 600; }
    header p { margin: 4px 0 0; opacity: .85; font-size: 13px; }
    .wrap { max-width: 1220px; margin: 0 auto; padding: 18px 20px 40px; }
    .legend { display: flex; gap: 18px; align-items: center; flex-wrap: wrap; margin: 10px 0 18px; }
    .key { display: inline-flex; align-items: center; gap: 8px; font-size: 12px; color: #374151; }
    .swatch { width: 14px; height: 14px; border-radius: 3px; border: 1px solid rgba(0,0,0,.1); }
    .swatch-existing { background: #eef2ff; border-color: #c7d2fe; }
    .swatch-new { background: #e6ffec; border-color: #86efac; }
    .diagram { background: #ffffff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 10px; overflow: auto; }
    .note { font-size: 12px; color: #6b7280; margin-top: 8px; }
    pre { background: #0b1021; color: #e5e7eb; padding: 12px; border-radius: 8px; overflow: auto; font-size: 12px; }
  </style>
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true, theme: 'neutral', securityLevel: 'loose', flowchart: { useMaxWidth: true, curve: 'basis' } });
  </script>
</head>
<body>
  <header>
    <h1>Phase 2C — Hunter Waterfall (Final Flow)</h1>
    <p>This mirrors the n8n layout. New Phase 2C nodes are implicit in the Hunter path.</p>
  </header>
  <div class="wrap">
    <div class="legend">
      <span class="key"><span class="swatch swatch-existing"></span> Existing Phase 2B nodes</span>
      <span class="key"><span class="swatch swatch-new"></span> New Phase 2C nodes (Hunter Waterfall)</span>
    </div>

    <div class="diagram mermaid">
    graph LR
    subgraph Ingress_Normalization
    A[Kajabi Webhook] --> B[Validate API Key - Dynamic] --> C[Smart Field Mapper]
    end
    C --> D{Feature Gate: PERSON_WATERFALL_ENABLED}
    subgraph Person_Enrichment
    PDL[PDL Person Enrichment] --> PPROC[PDL Person Processor]
    PPROC --> S{PDL Success Check}
    end
    D --> PDL
    S -->|true| M[(Data Merge: PDL > Hunter)]
    S -->|false| HHTTP[Hunter.io People Find]
    HHTTP --> HPROC[Hunter Response Processor]
    HPROC --> M
    M --> ICP[OpenAI ICP Scoring V3]
    M -.-> HR[Add to Human Review Queue]
    ICP --> ICPP[ICP Response Processor]
    ICPP --> ROUTE{Score-Based Routing V3.0}
    ROUTE -->|Low Score| AL[Archive Low Scores] --> AA[Archive to Airtable]
    ROUTE -->|Continue| LUF[Log Unknown Fields] --> CUK[Check Unknown Fields] --> AS[Airtable Search - Dynamic] --> DH[Duplicate Handler - Dynamic] --> RBD{Route by Duplicate}
    RBD -->|Duplicate| UPS[Airtable Upsert - Dynamic]
    RBD -->|New Record| CRT[Airtable Create - Dynamic]
    </div>

    <details>
      <summary>Show Mermaid source</summary>
      <pre><code>graph LR
subgraph Ingress_Normalization
A[Kajabi Webhook] --> B[Validate API Key - Dynamic] --> C[Smart Field Mapper]
end
C --> D{Feature Gate: PERSON_WATERFALL_ENABLED}
subgraph Person_Enrichment
PDL[PDL Person Enrichment] --> PPROC[PDL Person Processor]
PPROC --> S{PDL Success Check}
end
D --> PDL
S -->|true| M[(Data Merge: PDL > Hunter)]
S -->|false| HHTTP[Hunter.io People Find]
HHTTP --> HPROC[Hunter Response Processor]
HPROC --> M
M --> ICP[OpenAI ICP Scoring V3]
M -.-> HR[Add to Human Review Queue]
ICP --> ICPP[ICP Response Processor]
ICPP --> ROUTE{Score-Based Routing V3.0}
ROUTE -->|Low Score| AL[Archive Low Scores] --> AA[Archive to Airtable]
ROUTE -->|Continue| LUF[Log Unknown Fields] --> CUK[Check Unknown Fields] --> AS[Airtable Search - Dynamic] --> DH[Duplicate Handler - Dynamic] --> RBD{Route by Duplicate}
RBD -->|Duplicate| UPS[Airtable Upsert - Dynamic]
RBD -->|New Record| CRT[Airtable Create - Dynamic]
</code></pre>
    </details>
  </div>
</body>
</html>
